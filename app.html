<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Map Extract ‚Äî App</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --accent:#0077ff; }
  body { font-family:Arial, sans-serif; margin:0; padding:24px; background:#f6f7fb; color:#222; }
  .container { max-width:1200px; margin:0 auto; background:#fff; border-radius:10px; padding:18px; box-shadow:0 6px 30px rgba(10,20,40,0.06); }
  header { display:flex; align-items:center; justify-content:space-between; gap:12px; }
  h1 { margin:0; font-size:20px; color:#06345a; }
  .controls { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  button { background:var(--accent); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
  .muted-btn { background:#eef4ff; color:#06345a; border:1px solid #dbeafe; }
  .secondary { background:#f2f6fb; color:#06345a; border:1px solid #dbeafe; }
  .danger { background:#ffe9ec; color:#7a1220; border:1px solid #e9b5be; }
  main { display:grid; grid-template-columns:1fr 360px; gap:18px; margin-top:16px; }
  #left { min-height:420px; }
  .upload-box { border:2px dashed var(--accent); padding:16px; border-radius:10px; text-align:center; background:#f8fbff; }

  /* Maintain aspect ratio properly */
  canvas {
    display: block;
    max-width: 100%;
    height: auto;
    border: 1px solid #e6e9ef;
    background: #fff;
    cursor: crosshair;
  }

  table { width:100%; border-collapse:collapse; margin-top:8px; }
  td,th { padding:6px; border-bottom:1px solid #f0f2f6; font-size:13px; }
  .small { font-size:13px; color:#666; }
  .status { margin-top:8px; color:#333; }
  input[type="number"] { width:110px; padding:6px; border-radius:6px; border:1px solid #dbe3ee; }
</style>
</head>
<body>

<!-- ‚≠ê BACK BUTTON -->
<button onclick="window.location.href='landing.html'"
        style="
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 16px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            z-index: 999;
        ">
    ‚Üê Back to Home
</button>

<div class="container">
  <header>
    <h1>Map Extract ‚Äî Water Extraction & Georeferencing</h1>
    <div class="controls">
      <button id="btn-georef" class="muted-btn">Georeference Mode</button>
      <button id="btn-clear-gcps" class="secondary">Clear GCPs</button>
      <button id="btn-compute" class="secondary">Compute Transform</button>
      <button id="btn-export-geojson" class="secondary">Export Water GeoJSON</button>
    </div>
  </header>

  <main>
    <section id="left">
      <div class="upload-box">
        <button id="select-pdf">Select PDF</button>
        <input type="file" id="file-input" accept="application/pdf" style="display:none" />
      </div>

      <canvas id="pdf-canvas"></canvas>
      <div class="status" id="status">Status: idle</div>
    </section>

    <aside id="right">

      <!-- Instructions -->
      <div id="instructions-section" style="margin-bottom:20px;">
        <h3 id="instructions-toggle" style="cursor:pointer; margin:0;">
          üìò Instructions ‚ñº
        </h3>

        <div id="instructions-content" style="margin-top:10px; font-size:13px; line-height:1.45;">
          <p><strong>1Ô∏è‚É£ Upload your map</strong><br>Click ‚ÄúSelect PDF‚Äù.</p>
          <p><strong>2Ô∏è‚É£ Enter Georeference Mode</strong><br>Add pixel points, enter longitude/latitude.</p>
          <p><strong>3Ô∏è‚É£ Compute Transform</strong><br>Affine or Polynomial models supported.</p>
          <p><strong>4Ô∏è‚É£ Extract Water</strong><br>Automatically detect lakes/rivers.</p>
          <p><strong>5Ô∏è‚É£ Export</strong><br>Download as GeoJSON for GIS tools.</p>
        </div>
      </div>

      <h3>Ground Control Points</h3>
      <div class="small">Click the map in Georeference Mode to add pixel points.</div>

      <table id="gcp-table">
        <thead>
          <tr><th>px X</th><th>px Y</th><th>lon</th><th>lat</th><th></th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:10px">
        <label class="small">Transform Model:</label><br>
        <select id="model-select">
          <option value="affine">Affine (3+ points)</option>
          <option value="poly2">2nd-degree Polynomial (6+ points)</option>
        </select>
      </div>

      <div style="margin-top:12px">
        <div class="small">RMS error:</div>
        <div id="rms" style="font-weight:700;margin-top:4px">‚Äî</div>
      </div>

      <hr style="margin:20px 0"/>

      <div>
        <h3>Water Extraction</h3>
        <button id="btn-extract-water" class="secondary" style="margin-bottom:6px;">Extract Water</button>
        <button id="btn-clear-water" class="secondary">Clear Water</button>

        <div style="margin-top:12px;">
          <label>
            <input type="checkbox" id="chk-water-overlay" checked />
            Show Water Overlay
          </label>
        </div>

        <div class="small" style="margin-top:8px;">
          Water features detected:
          <span id="water-count" style="font-weight:bold;">0</span>
        </div>
      </div>

    </aside>
  </main>
</div>

<!-- PDF.js -->
<script src="./libs/pdf.js"></script>
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc = "./libs/pdf.worker.js";
</script>

<!-- SAM stub -->
<script src="./libs/sam.js"></script>

<!-- Your full app logic goes here -->
<script src="script.js"></script>

</body>
</html>
