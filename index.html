<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Map Extract</title>
    <style>
        body { font-family: Arial, sans-serif; margin:0; padding:0; color:#333; }
        .hero { background:#f0f7ff; padding:40px 20px; text-align:center; }
        .hero h1 { font-size:48px; margin-bottom:20px; }
        .hero p { font-size:20px; max-width:600px; margin:0 auto 30px; line-height:1.5; }
        .upload-box { border:2px dashed #0077ff; border-radius:12px; padding:50px; max-width:400px; margin:20px auto; text-align:center; background:#f9fbff; cursor:pointer; }
        .upload-box:hover { background:#f0f7ff; border-color:#005fcc; }
        .upload-box p { margin:0 0 15px 0; font-size:18px; color:#0077ff; }
        .upload-box button { padding:10px 20px; font-size:16px; border-radius:6px; border:none; background:#0077ff; color:white; cursor:pointer; }
        .upload-box button:hover { background:#005fcc; }
        canvas { display:block; margin:20px auto; border:1px solid #ccc; }
    </style>
</head>
<body>

<section class="hero">
    <h1>Map Extract</h1>
    <p>Upload a map PDF and segment areas of interest.</p>

    <div class="upload-box" id="upload-box">
        <p>Drag & drop PDF here</p>
        <button id="select-pdf">Select Your File</button>
        <input type="file" id="pdf-upload" accept="application/pdf" style="display:none" />
    </div>

    <canvas id="map-canvas"></canvas>
</section>

<!-- PDF.js local libs -->
<script src="./libs/pdf.js"></script>
<script src="./libs/pdf.worker.js"></script>

<!-- SAM script -->
<script src="./libs/sam.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById('pdf-upload');
    const selectBtn = document.getElementById('select-pdf');
    const uploadBox = document.getElementById('upload-box');
    const canvas = document.getElementById('map-canvas');
    const ctx = canvas.getContext('2d');

    selectBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
        const page = await pdf.getPage(1);
        const viewport = page.getViewport({scale: 2});
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({canvasContext: ctx, viewport: viewport}).promise;

        // Enable segmentation on click
        canvas.addEventListener('click', async (ev) => {
            const rect = {
                x: 50, y: 50,
                width: viewport.width/3,
                height: viewport.height/3
            };
            const mask = await window.samSegment(canvas, rect);
            console.log('Segmentation mask:', mask);
        }, { once: true });
    });
});
</script>
</body>
</html>
