<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Map Extract</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; color:#333; }
    .hero { background:#f0f7ff; padding:80px 20px; text-align:center; }
    .hero h1 { font-size:48px; margin-bottom:20px; }
    .hero p { font-size:20px; max-width:600px; margin:0 auto 30px; line-height:1.5; }
    .cta-btn { padding:14px 28px; background:#0077ff; color:white; font-size:18px; border:none; border-radius:8px; cursor:pointer; }
    .cta-btn:hover { background:#005fcc; }
    .upload-box { border:2px dashed #0077ff; border-radius:12px; padding:50px; max-width:500px; margin:0 auto; text-align:center; background:#f9fbff; cursor:pointer; }
    .upload-box:hover { background:#f0f7ff; border-color:#005fcc; }
    .upload-box p { margin:0 0 15px 0; font-size:18px; color:#0077ff; }
    .upload-box button { padding:10px 20px; font-size:16px; border-radius:6px; border:none; background:#0077ff; color:white; cursor:pointer; }
    .upload-box button:hover { background:#005fcc; }
    .how-it-works { padding:60px 20px; max-width:900px; margin:0 auto; }
    .how-it-works h2 { font-size:36px; margin-bottom:50px; text-align:center; }
    .steps { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:30px; justify-items:center; }
    .step { background:#fafafa; padding:25px; border-radius:12px; border:1px solid #eee; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.05); }
    .step h3 { margin-bottom:10px; }
    #pdf-preview { max-width:90%; max-height:600px; margin:20px auto; display:block; border:1px solid #ccc; }
  </style>
</head>
<body>

  <!-- HERO SECTION -->
  <section class="hero">
    <h1>Map Extract</h1>
    <p>Upload any map PDF and get clean, accurate extracted data â€” ready for GIS, analysis, or digitization.</p>

    <div class="upload-box" id="upload-box">
      <p>Drag & drop PDF here</p>
      <button id="select-pdf">Select Your File</button>
      <input type="file" id="pdf-upload" style="display:none;" accept=".pdf"/>
    </div>

    <!-- PDF Preview -->
    <canvas id="pdf-preview"></canvas>
  </section>

  <!-- HOW IT WORKS -->
  <section class="how-it-works">
    <h2>How It Works</h2>
    <div class="steps">
      <div class="step">
        <h3>1. Upload Your Map</h3>
        <p>Drag and drop or select any map PDF.</p>
      </div>
      <div class="step">
        <h3>2. Preview & Edit</h3>
        <p>See a preview of your map and select areas to extract.</p>
      </div>
      <div class="step">
        <h3>3. Download Extracted Data</h3>
        <p>Get your output as a PNG or .shp file.</p>
      </div>
    </div>
  </section>

  <!-- PDF.js local libs -->
  <script src="./libs/pdf.js"></script>
  <script>
    if (!pdfjsLib) {
      alert("PDF library failed to load. Make sure you are online and the CDN is accessible.");
    }
    pdfjsLib.GlobalWorkerOptions.workerSrc = './libs/pdf.worker.js';
  </script>

  <!-- SAM segmentation script -->
  <script src="./libs/sam.js"></script>

  <script>
    const selectBtn = document.getElementById('select-pdf');
    const fileInput = document.getElementById('pdf-upload');
    const uploadBox = document.getElementById('upload-box');
    const canvas = document.getElementById('pdf-preview');
    const ctx = canvas.getContext('2d');

    selectBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const arrayBuffer = await file.arrayBuffer();
      try {
        const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
        const page = await pdf.getPage(1);
        const viewport = page.getViewport({scale:1.5});
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        await page.render({canvasContext: ctx, viewport}).promise;
      } catch (err) {
        console.error(err);
        alert("Error processing PDF. Make sure the PDF is valid.");
      }
    });
  </script>

</body>
</html>
